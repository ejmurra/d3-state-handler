var d3_state_handler={};d3_state_handler=function(e){function t(e,t,n){for(var r=0,a=e.length;a>r;r++)if(e[r][n]===t)return r;return-1}Object.assign||Object.defineProperty(Object,"assign",{enumerable:!1,configurable:!0,writable:!0,value:function(e){"use strict";if(void 0===e||null===e)throw new TypeError("Cannot convert first argument to object");for(var t=Object(e),n=1;n<arguments.length;n++){var r=arguments[n];if(void 0!==r&&null!==r){r=Object(r);for(var a=Object.keys(r),s=0,i=a.length;i>s;s++){var o=a[s],m=Object.getOwnPropertyDescriptor(r,o);void 0!==m&&m.enumerable&&(t[o]=r[o])}}}return t}});var n=function(e,n){var r=this,a=0,s=[],i=function(e){return e},o=n||{loop:!1,init:i,jumpState:{},data:{},load:i},m=o.jumpState,u=o.data,c={},f=function(e){var t=!c[e.name];if(!t)throw new Error("State "+e.name+" already exists!");return c[e.name]={render:e.render,fromNext:e.fromNext||i,fromPrev:e.fromPrev||i,toNext:e.toNext||i,toPrev:e.toPrev||i,jumpOut:e.jumpOut||i,jumpIn:e.jumpIn||i,resize:e.resize||e.render},s.length&&(s[s.length-1].next=e.name),e={prev:s.length?s[s.length-1].name:null,name:e.name,next:null,url:"#"+r.name},s.push(e),e},l=function(){var e=Object.assign({},u);e=s[a].resize(e),u=Object.assign({},u,e)},h=function(t){t.name=t.name||String(s.length),t=f(t),1===s.length&&e.history.pushState(t,t.name,"#"+t.name)},v=function(){return s[a]},g=function(e){var n=t(s,e,"name");n>-1&&array.splice(n,1)},j=function(n){var r=t(s,n,"name"),i=s[r];if(!(r>-1))throw new Error("State "+n+" does not exist");var f=o.load(Object.assign({},u));f=c[i.name].jumpIn(Object.assign({},m)),f=c[i.name].render(f),u=Object.assign({},u,f),a=r,e.history.pushState(i,i.name,"#"+i.name)},d=function(n){var r=t(s,n,"name"),i=s[a],o=s[r];if(!(r>-1))throw new Error("State "+n+" does not exist");var f=Object.assign({},u);f=c[i.name].jumpOut(f),f=c[o.name].jumpIn(Object.assign({},m)),f=c[o.name].render(f),u=Object.assign({},u,f),a=r,e.history.pushState(o,o.name,"#"+o.name)},b=function(){var n=s[a],r=n.next;if(!r)throw new Error("No state after current state ("+JSON.stringify(n)+")");var i=s[t(s,r,"name")],o=Object.assign({},u);o=c[n.name].toNext(o),o=c[i.name].fromPrev(o),o=c[i.name].render(o),u=Object.assign({},u,o),a=a+1<s.length?a+1:0,e.history.pushState(i,i.name,"#"+i.name)},O=function(){var n=s[a],r=n.prev;if(!r)throw new Error("No state before current state ("+JSON.stringify(n)+")");var i=s[t(s,r,"name")],o=Object.assign({},u);o=c[n.name].toPrev(o),o=c[i.name].fromNext(o),o=c[i.name].render(o),u=Object.assign({},u,o),a=a-1>=0?a-1:s.length-1,e.history.pushState(i,i.name,"name")},p=function(t){if(e.addEventListener("popstate",function(n){if(null===e.history.state.name){var r=Object.assign({},u);r=t?t(r):o.init(r),r=s[0].render(r),u=Object.assign({},u,r)}else d(e.history.state.name)}),e.addEventListener("resize",function(e){l()}),e.location.hash&&e.location.hash.slice(1)!==s[0].name)d(e.history.state.name);else{var n=Object.assign({},u);n=t?t(n):o.init(n),n=c[s[0].name].render(n),u=Object.assign({},u,n)}},y={next:b,add:h,currentState:v,prev:O,remove:g,load:j,jumpTo:d,start:p};return y};return e=n}(d3_state_handler);